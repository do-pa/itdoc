---
sidebar_position: 1
toc_max_heading_level: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# LLM-Powered Automatic Test Generation

> **A powerful feature of itdoc that automatically generates tests by analyzing source code through GPT.**

## Feature Overview

**Is your project overloaded with APIs, making it hard to manually write test specs for each one using Itdoc?**

```js
const app = require("./expressApp")
const { describeAPI, itDoc, HttpStatus, field, HttpMethod } = require("itdoc")

describeAPI(
    HttpMethod.POST,
    "/signup",
    {
        summary: "User Registration API",
        tag: "Auth",
        description: "Registers a new user with username and password.",
    },
    app,
    (apiDoc) => {
        // Multiple test cases
        // ....
        // ....
        // ....
     });
```

Then try itdoc's LLM feature! This feature can automatically generate itdoc test code like the one above.

Let's compare before and after using the LLM feature.

<Tabs>
    <TabItem value="before" label="ðŸš« Before (Manual)" default>

        **Express App Source Code**
        ```js title="app.js"
        const express = require("express")
        const authenticationRouter = require("./authentication")

        const app = express()

        app.use(express.json())
        app.use("/auth", authenticationRouter);
        module.exports = app
        ```

        **Manual Test Code Writing Required**
        ```js
        // Developers need to analyze and write manually
        // Time-consuming and error-prone
        // ...
        ```

    </TabItem>
    <TabItem value="after" label="âœ… After (LLM Auto-generation)">

        **With Just One Command**
        ```bash
        itdoc generate --app ./app.js
        ```

        **Automatically Generated Test Code**
        ```js title="Generated Test File"
        const targetApp = app

        describeAPI(
            HttpMethod.POST,
            "/signup",
            {
                summary: "User Registration API",
                tag: "Auth",
                description: "Registers a new user.",
            },
            targetApp,
            (apiDoc) => {
                itDoc("Returns 400 response when username is missing", async () => {
                    await apiDoc
                        .test()
                        .req()
                        .body({
                            password: field("Password", "password123"),
                        })
                        .res()
                        .status(HttpStatus.BAD_REQUEST)
                        .body({
                            error: field("Error message", "username is required"),
                        })
                })

                itDoc("Returns 400 response when password is missing", async () => {
                    await apiDoc
                        .test()
                        .req()
                        .body({
                            username: field("Username", "newuser"),
                        })
                        .res()
                        .status(HttpStatus.BAD_REQUEST)
                        .body({
                            error: field("Error message", "password is required"),
                        })
                })

                itDoc("Returns 400 response when password is less than 8 characters", async () => {
                    await apiDoc
                        .test()
                        .req()
                        .body({
                            username: field("Username", "newuser"),
                            password: field("Password", "short"),
                        })
                        .res()
                        .status(HttpStatus.BAD_REQUEST)
                        .body({
                            error: field("Error message", "password must be at least 8 characters"),
                        })
                })

                itDoc("Returns 201 response when all conditions are met", async () => {
                    await apiDoc
                        .test()
                        .req()
                        .body({
                            username: field("Username", "newuser"),
                            password: field("Password", "password123"),
                        })
                        .res()
                        .status(HttpStatus.CREATED)
                })
            }
        )
        ```

        Quickly adopt Itdoc with LLM functionality!
    </TabItem>
</Tabs>

## Requirements

- `itdoc` must be installed to use the CLI commands.

- This feature uses the ChatGPT API. Set up your OpenAI API key as follows:

  ```bash title="Add your key to the .env file like this"
  echo OPENAI_API_KEY={ENTER_YOUR_GPT_KEY} > .env
  ```

  > Alternatively, you can specify the path to a `.env` file that contains `OPENAI_API_KEY` as shown below:
  > ```bash
  > itdoc --e {YOUR_ENV_FILE_PATH}
  > itdoc --env {YOUR_ENV_FILE_PATH}
  > ```


:::danger[API Key Security Warning]
**Add the `.env` file to `.gitignore` to prevent it from being uploaded to your Git repository**

```bash title="Content to add to .gitignore"
.env
```
:::

:::tip
- The `.env` file is searched in the current working directory by default. If it's in a different location, use the `-e` option to specify it.
- You can get an OpenAI API key from your [OpenAI account](https://platform.openai.com/signup).
- API usage incurs costs, so check the [OpenAI pricing](https://openai.com/pricing).
  - Usually, a small-sized app costs a one dollar.
:::

## Usage

### Generating Tests from Source Code

:::warning[Check First!]
Currently, source code-based automatic test generation is only supported for the Express framework. If you're using a different framework, use the [API Spec Markdown-based test generation method](#generating-tests-from-api-spec-markdown).
:::

```bash
itdoc generate -a {YOUR_APP_FILE_PATH}
itdoc generate --app {YOUR_APP_FILE_PATH}
```

| Option                                                                 | Description                    |
|------------------------------------------------------------------------|--------------------------------|
| <span style={{color: '#0d6efd', fontWeight: 'bold'}}>--app (-a)</span> | Root app source code file path |

When you run this command, it analyzes the Express application defined in `{YOUR_APP_FILE_PATH}` and automatically generates tests for the API endpoints in that application.

:::info[itdoc does not send source code to external servers]
It creates an `API Spec Markdown` through its own AST analysis and sends this to ChatGPT to generate test cases.
Therefore, you can use it with confidence as your source code is not sent to external servers.
:::

### Generating Tests from API Spec Markdown

You can automatically generate tests based on an `API Spec Markdown` file with the following command:

```bash
itdoc generate --p {API_Spec_Markdown_FILE_PATH}
itdoc generate --path {API_Spec_Markdown_FILE_PATH}
```

| Option                                                                  | Description                   |
|-------------------------------------------------------------------------|-------------------------------|
| <span style={{color: '#0d6efd', fontWeight: 'bold'}}>--path (-p)</span> | `API Spec Markdown` file path |

The document format should follow this structure:

```markdown title="api-specs.md" {1-4}
`HTTP_METHOD` `ENDPOINT`
- Test Case: Test case title
  - Request: Description of the request
  - Response: Description of the response
```

Here are examples for various API cases:

<Tabs>
    <TabItem value="auth" label="ðŸ” Authentication API" default>

        ```markdown title="Authentication API Example"
        GET /secret
        - Test Case: Access secret message with proper authentication
          - Request: Send GET request with valid authentication header
          - Response: Status code 200, JSON response with secret message and specific headers
        - Test Case: Unauthorized access
          - Request: Send GET request with invalid authentication header
          - Response: Returns status code 401
        ```

    </TabItem>
    <TabItem value="file" label="ðŸ“ File Upload API">

        ```markdown title="File Upload API Example"
        POST /users/:userId/profile-image
        - Test Case: Successfully upload profile image
          - Request: Send POST request with valid image file and "multipart/form-data" content type
          - Response: Status code 200, JSON response with image URL
        - Test Case: Wrong content type
          - Request: Send POST request without "multipart/form-data" content type
          - Response: Status code 400, JSON response with error message
        ```

    </TabItem>
</Tabs>

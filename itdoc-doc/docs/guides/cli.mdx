---
sidebar_position: 1
toc_max_heading_level: 3
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# üìò CLI Guide

itdoc CLI is a test-driven documentation tool for RESTful services. This guide details the installation and usage of CLI commands.

## üöÄ Installation

```bash title="Installation command"
npm install -g itdoc
```

## ‚úÖ Requirements

:::info Check before starting
- **Node.js 20 or higher** - Supports the latest JavaScript features
- **OpenAI API key** - Required for LLM-based document generation
:::

## ‚öôÔ∏è Environment Setup

itdoc loads settings from a `.env` file. Create a `.env` file in your project's root directory:

```bash title=".env file example" {2}
# OpenAI API key configuration
OPENAI_API_KEY=your-openai-api-key-here
```

:::tip Environment Variable Location
The `.env` file is looked for in the current working directory by default. If it's in a different location, you can specify it with the `-e` option.
:::

## üìã Commands

### `generate`

Generates ITDOC test code based on LLM. You can generate documentation based on either a test spec markdown or an Express app path.

#### Usage

```bash title="Basic usage"
itdoc generate [options]
```

#### Options

| Option | Description | Required |
|------|------|--------|
| <span style={{color: '#0d6efd', fontWeight: 'bold'}}>-p, --path</span> | Test spec markdown path | Either `-p` or `-a` is required |
| <span style={{color: '#0d6efd', fontWeight: 'bold'}}>-a, --app</span> | Express root app path | Either `-p` or `-a` is required |
| <span style={{color: '#0d6efd', fontWeight: 'bold'}}>-e, --env</span> | .env file path | Optional (default: .env in current directory) |

#### Examples

<Tabs>
  <TabItem value="spec" label="Test Spec Based" default>

```bash title="Test spec based commands" {2,8}
# Using a relative path
itdoc generate -p ./docs/api-specs.md

# Using an absolute path
itdoc generate --path /path/to/your/api-specs.md

# Specifying a custom .env file
itdoc generate -p ./docs/api-specs.md -e ./config/.env.dev
```

  </TabItem>
  <TabItem value="app" label="Express App Based">

```bash title="Express app based commands" {2,5}
# Using an Express app path
itdoc generate -a ./src/app.js

# Using an absolute path and custom environment file
itdoc generate --app /path/to/your/app.js --env /path/to/your/.env.production
```

  </TabItem>
</Tabs>

---

## üìù API Spec Markdown Writing Guide

API spec markdown (`api-specs.md`) is the foundation document for itdoc to automatically generate test code. Follow the format below when writing:

### Basic Structure

```markdown title="api-specs.md" {1,3-4}
HTTP_METHOD /endpoint
- Test Case: Test case title
  - Request: Request description
  - Expected Response: Expected response description

- Test Case: Another test case title
  - Request: Request description
  - Expected Response: Expected response description

ANOTHER_HTTP_METHOD /another_endpoint
- Test Case: Test case title
  ...
```

### Detailed Explanation

1. üìå **API Endpoint Declaration**
   - Each API starts with the `HTTP_METHOD /path` format (e.g., `POST /signup`)
   - For path parameters, use the `:parameterName` format (e.g., `/users/:userId`)

2. üß™ **Test Case Definition**
   - Each test case is written in the `- Test Case: test title` format
   - The test title should clearly indicate the purpose of the test (e.g., "Successful signup")

3. üì§ **Request Description**
   - Written in the `  - Request: request description` format
   - Clearly describe request methods, headers, body, query parameters, path parameters, etc.

4. üì• **Expected Response Description**
   - Written in the `  - Expected Response: response description` format
   - Clearly describe expected status codes, response body, headers, etc.

### Example

```markdown title="Signup and User Retrieval API Example" {1-5,14-17}
POST /signup
- Test Case: Successful signup
  - Request: Send a POST request with a valid username and password in the body.
  - Expected Response: Status 201

- Test Case: Missing username
  - Request: Send a POST request with a missing username in the body.
  - Expected Response: Status 400, JSON response with error "username is required"

- Test Case: Password too short
  - Request: Send a POST request with a password shorter than 8 characters.
  - Expected Response: Status 400, JSON response with error "password must be at least 8 characters"

GET /users/:userId
- Test Case: Retrieve user details successfully
  - Request: Send a GET request with userId "penek".
  - Expected Response: Status 200, JSON response with user details

- Test Case: User not found
  - Request: Send a GET request with a userId other than "penek".
  - Expected Response: Status 404
```

### Key API Pattern Examples

<Tabs>
  <TabItem value="auth" label="üîê Authentication API" default>

```markdown title="Authentication API Example"
GET /secret
- Test Case: Access secret message with valid authorization
  - Request: Send a GET request with the correct authorization header.
  - Expected Response: Status 200, JSON response with secret message and specific headers

- Test Case: Unauthorized access
  - Request: Send a GET request with an incorrect authorization header.
  - Expected Response: Status 401
```

  </TabItem>
  <TabItem value="file" label="üìÅ File Upload API">

```markdown title="File Upload API Example"
POST /users/:userId/profile-image
- Test Case: Successfully upload profile image
  - Request: Send a POST request with a valid image file and content type "multipart/form-data".
  - Expected Response: Status 200, JSON response with image URL

- Test Case: Invalid content type
  - Request: Send a POST request without "multipart/form-data" content type.
  - Expected Response: Status 400, JSON response with error message
```

  </TabItem>
  <TabItem value="cache" label="üîÑ Caching API">

```markdown title="Caching API Example"
GET /cached-data
- Test Case: Retrieve cached data with matching ETag
  - Request: Send a GET request with If-None-Match header set to "abc123".
  - Expected Response: Status 304, response with ETag and Cache-Control headers

- Test Case: Retrieve cached data with non-matching ETag
  - Request: Send a GET request without If-None-Match header or with a different value.
  - Expected Response: Status 200, JSON response with data and headers including ETag
```

  </TabItem>
</Tabs>

:::tip Effective API Spec Writing Tips üí°
- Include both **success cases** and **failure cases** for each API endpoint.
- Consider various scenarios for the same endpoint (authentication errors, validation errors, resource not found, etc.).
- Make request and response descriptions concise yet include all necessary information (status codes, key response fields, etc.).
- When writing multiple APIs in one file, group related APIs together.
:::

### Test Case Writing Checklist

:::info Test Case Checklist
- ‚úÖ **Success cases**: Normal operation with valid inputs
- ‚úÖ **Validation**: Missing required fields, incorrect formats, out-of-range values, etc.
- ‚úÖ **Authentication/Authorization**: Authentication failures, insufficient permissions, etc.
- ‚úÖ **Resource access**: Non-existent resources, already existing resources, etc.
- ‚úÖ **Special situations**: Caching, conditional requests, large data, etc.
:::

---

## üîÑ How It Works

### Express App Writing Guide

itdoc uses an AST parser to analyze Express app code. Follow these guidelines so the parser can correctly detect your routers:

#### Supported Router Patterns

:::note app object usage

```javascript title="app object usage example"
app.get('/path', (req, res) => { ... })
app.post('/path', (req, res) => { ... })
// Other HTTP methods: put, delete, patch, all
```

:::

:::note router object usage

```javascript title="router object usage example"
router.get('/path', (req, res) => { ... })
router.post('/path', (req, res) => { ... })
// Other HTTP methods: put, delete, patch, all
```

:::

#### Router Handler Writing Requirements

<Tabs>
  <TabItem value="params" label="üîç Path Parameters" default>

```javascript {2,4} title="Path parameter usage example"
app.get('/users/:userId', (req, res) => {
  const { userId } = req.params; // Using destructuring assignment
  // or
  const userId = req.params.userId; // Direct access is also supported
  // ...
});
```

  </TabItem>
  <TabItem value="query" label="üîç Query Parameters">

```javascript {2,4} title="Query parameter usage example"
app.get('/users', (req, res) => {
  const { page, size } = req.query; // Destructuring assignment
  // or
  const page = req.query.page; // Direct access
  // ...
});
```

  </TabItem>
  <TabItem value="body" label="üì¶ Request Body">

```javascript {2,4} title="Request body usage example"
app.post('/users', (req, res) => {
  const { username, password } = req.body; // Destructuring assignment
  // or
  const username = req.body.username; // Direct access
  // ...
});
```

  </TabItem>
  <TabItem value="response" label="üì§ Response Return">

```javascript {3,6,9,12,14-17} title="Response return example"
app.get('/users', (req, res) => {
  // Setting status code
  res.status(200);

  // JSON response
  res.json({ users: [...] });

  // Or string/HTML response
  res.send('Hello World');

  // Setting headers
  res.setHeader('Content-Type', 'application/json');
  // or
  res.set({
    'Content-Type': 'application/json',
    'Cache-Control': 'no-cache'
  });
});
```

  </TabItem>
  <TabItem value="conditional" label="üîÄ Conditional Response">

```javascript {4-7,10-13,16} title="Conditional response example"
app.post('/users', (req, res) => {
  const { username, password } = req.body;

  if (!username) {
    // Conditional response - the parser detects this branching
    return res.status(400).json({ error: 'username is required' });
  }

  if (password.length < 8) {
    return res.status(400).json({
      error: 'password must be at least 8 characters'
    });
  }

  // Success response
  return res.status(201).json({ id: 'new-user-id' });
});
```

  </TabItem>
</Tabs>

#### Complete Example

:::info Example Code

```javascript title="Complete app.js example" {7-24,28-40,44-64}
import express from 'express';

const app = express();
app.use(express.json());

// User registration API
app.post('/signup', (req, res) => {
  const { username, password } = req.body;

  if (!username) {
    return res.status(400).json({ error: 'username is required' });
  }

  if (!password) {
    return res.status(400).json({ error: 'password is required' });
  }

  if (password.length < 8) {
    return res.status(400).json({ error: 'password must be at least 8 characters' });
  }

  // In practice, this is where you would save user information to a database
  return res.status(201).json();
});

// User details retrieval API
app.get('/users/:userId', (req, res) => {
  const { userId } = req.params;

  // Example: only process specific test ID
  if (userId === 'testuser') {
    return res.status(200).json({
      id: userId,
      name: 'Test User',
      email: 'test@example.com'
    });
  }

  return res.status(404).json({ error: 'User not found' });
});

// User list retrieval API with pagination
app.get('/users', (req, res) => {
  const { page, size } = req.query;

  if (!page) {
    return res.status(400).json({ error: 'page parameter is required' });
  }

  if (!size) {
    return res.status(400).json({ error: 'size parameter is required' });
  }

  // Return paginated user list
  return res.status(200).json({
    users: [
      { id: 'user1', name: 'User 1' },
      { id: 'user2', name: 'User 2' }
    ],
    page: Number(page),
    size: Number(size),
    total: 2
  });
});

export default app;
```

:::

:::warning Caution ‚ö†Ô∏è
Patterns that the parser cannot detect:
- Routers defined within middleware functions
- Dynamically generated paths (paths using variables)
- Complex routing structures using controller class methods
:::

### Test Spec Based Workflow

When generating documentation through test spec markdown (using the `-p` option), itdoc performs the following steps:

:::note Workflow Steps
1. üìÑ **Load and analyze the markdown file**
2. üß† **Generate test code through OpenAI API** (maximum 3 attempts)
3. üíæ **Save the resulting test code to `./itdoc-output/output.js`**
:::

### App Based Workflow

When generating documentation through an Express app (using the `-a` option), itdoc performs the following steps:

:::note Workflow Steps
1. üìÑ **Load Express app code and run AST analysis**
2. üîç **Extract API route information** (`app.get()`, `router.post()`, etc.)
3. üìù **Generate test spec markdown through OpenAI API**
4. üß™ **Generate test code based on the created markdown**
5. üíæ **Save the result files to the `./itdoc-output/` directory**
:::

---

## üìÅ Output Results

After command execution, the following files are generated in the `./itdoc-output/` directory:

:::info Generated Files
- üìÑ **`output.js`**: Generated test code
- üìÑ **`output.md`**: Generated test spec (when using app-based generation)
:::

## ‚ùì Troubleshooting

### Common Errors

:::danger Error: Environment variable OPENAI_API_KEY is not set
Verify that you have set a valid OpenAI API key in your `.env` file.
:::

:::danger Error: AST analysis of the app failed
Verify that your Express app code uses standard routing patterns like `app.get()` or `router.post()`.
:::

:::danger Error: Failed to generate test code based on markdown spec
- Check that your markdown file is formatted correctly and the API specification is clearly written.
- Verify your OpenAI API connection status and usage limits.
:::


